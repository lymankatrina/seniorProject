<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>San Juan Theater | Home Page</title>
    <meta name="description" content="Home Page for San Juan Theater" />
    <link rel="stylesheet" href="https://use.typekit.net/vem8cxz.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://kit.fontawesome.com/db6c0dda2a.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <header id="main-header">
      <div class="header">
        <img src="/images/movie_projector_gray.svg" class="header-left" alt="Movie Projector Icon" />
        <img src="/images/Theater_logo_new_2.svg" class="header-logo" alt="San Juan Theater Logo" />
        <nav class="nav">
          <a href="https://sanjuantheater.onrender.com/" target="home" class="active"><span class="header-icons fa-solid fa-house"></span></a>
          <a href="https://sanjuantheater.onrender.com/login"><span class="header-icons fa-solid fa-user"></span></a>
          <a href="/contact.html" target="Contact"><span class="header-icons fa-solid fa-envelope"></span></a>
          <a href="/contact.html" target="Contact"><span class="header-icons fa-solid fa-phone"></span></a>
          <a href="/about.html" target="History">About</a>
        </nav>
      </div>
    </header>
    <main>
      <div class="headings">
        <section class="nowPlaying">
          <h1 class="urbaneBold">Now Playing</h1>
          <div id="nowPlayingContainer"></div>
          <div id="message"></div>
        </section>
        <h2 class="urbaneBold">Coming Soon</h2>
      </div>
    </main>
    <footer class="obliqua">
      &copy; <span id="currentYear"></span> | 10 South Main St | Blanding Utah |
      <a class="footerLink" href="https://sanjuantheater.onrender.com">San Juan Movie Theater</a><br />
      Last Updated: <span id="updateDate"></span>
    </footer>
    <script src="/script/footerFunction.js"></script>
    <script>
      fetch('https://sanjuantheater.onrender.com/movies/nowplaying')
        .then((response) => response.json())
        .then((data) => {
          const cardsContainer = document.getElementById('nowPlayingContainer');

          // Create a card for each item in the JSON data
          data.forEach((item) => {
            const genresFormatted = item.genres.join(', ');
            const startDate = new Date(item.startDate);
            const endDate = new Date(item.endDate);
            const formattedStartDate = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(
              startDate
            )} ${startDate.getDate()}, ${startDate.getFullYear()}`;
            const formattedEndDate = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(
              endDate
            )} ${endDate.getDate()}, ${endDate.getFullYear()}`;
            const card = document.createElement('div');
            card.className = 'nowPlayingCard';
            card.innerHTML = `
              <h2 class="nowPlayingTitle">${item.title} ${item.year}</h2>
              <h3 class="nowPlayingTagline">${item.tagLine}</h3>
              <h3 class="nowPlayingDates">${formattedStartDate} to ${formattedEndDate}</h3>
              <div class="ratings">
                <p class="nowPlayingRating">Rating: ${item.certification}</p>
                <p class="nowPlayingRuntime">Runtime: ${item.runtime}</p>
                ${item.imdbScore ? `<p class="nowPlayingIMDB"><span class="fa-brands fa-imdb"></span> ${item.imdbScore}</p>` : ''}
                ${item.rottenTomatoes ? `<p class="nowPlayingTomatoes"><span class="fa-solid fa-thumbs-up"></span> ${item.rottenTomatoes}</p>` : ''}
              </div>
              <div class="genres">
                <p class="nowPlayingGenres">Genres: ${genresFormatted}</p>
              </div>
              <div class="nowPlayingCardImage">
                ${item.poster ? `<img src="${item.poster}" class="nowPlayingPoster">` : ''}
              </div>
              <div class="overviewContainer">
                <p class="nowPlayingOverview">${item.overview}</p>
              </div>
              <iframe src="${item.trailer}" class="nowPlayingTrailer"></iframe>
              `;
            cardsContainer.appendChild(card);
          });
        })
        .catch((error) => {
          console.error('Error fetching data:', error);
        });
    </script>
  </body>
</html>
