<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>San Juan Theater | Admin Update Movies</title>
    <meta name="description" content="Admin update a movie for San Juan Theater" />
    <link rel="stylesheet" href="https://use.typekit.net/vem8cxz.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://kit.fontawesome.com/db6c0dda2a.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <header id="main-header">
      <div class="header">
        <img src="/images/Theater_logo_new_2.svg" class="header-logo" alt="San Juan Theater Logo" />
        <nav class="nav">
          <a href="https://sanjuantheater.onrender.com/" target="home" id="userGreeting"></a>
          <a href="/movies.html" target="Movies">Add Movies</a>
          <a href="/updateMovies.html" target="Movies" class="active">Update Movies</a>
          <a href="/news.html" target="News">Add News</a>
          <a href="/events.html" target="Events">Add Events</a>
          <a href="/users.html" target="Users">Manage Users</a>
        </nav>
      </div>
    </header>
    <main>
      <h1>San Juan Theater Admin</h1>
      <h2>Manage Movies Collection</h2>
      <h3>Update a Movie</h3>
      <form id="updateMovieForm" action="https://sanjuantheater.onrender.com/movies/:id" method="GET">
        <label for="_id">ID:</label><br />
        <input type="text" id="_id" name="_id" required /><br /><br />
        <input type="submit" value="GetMovie" onclick="getMovie(event)" /><br />
        <div id="updateFormFields" style="display: none">
          <label for="title">Movie Title</label>
          <input class="input-newMovie" type="text" id="title" name="title" required /><br /><br />
          <label for="tagLine">Tag Line</label>
          <input class="input-newMovie" type="text" id="tagLine" name="tagLine" /><br /><br />
          <label for="overview">Overview</label>
          <input class="input-newMovie" type="text" id="overview" name="overview" required /><br /><br />
          <label for="year">Year</label>
          <input class="input-newMovie" type="number" id="year" name="year" required placeholder="YYYY" /><br /><br />
          <label for="certification">Rating</label><br />
          <input class="input-newMovie" type="radio" id="certification" name="certification" value="G" />
          <label for="G">G</label><br />
          <input class="input-newMovie" type="radio" id="certification" name="certification" value="PG" />
          <label for="PG">PG</label><br />
          <input class="input-newMovie" type="radio" id="certification" name="certification" value="PG-13" />
          <label for="PG-13">PG-13</label><br />
          <input class="input-newMovie" type="radio" id="certification" name="certification" value="R" />
          <label for="R">R</label><br />
          <input class="input-newMovie" type="radio" id="certification" name="certification" value="NC-17" />
          <label for="NC-17">NC-17</label><br /><br />
          <label for="releaseDate">Release Date</label>
          <input class="input-newMovie" type="date" id="releaseDate" name="releaseDate" pattern="YYYY-MM-DD" /><br /><br />
          <label>Genres: Select all that apply</label>
          <input type="checkbox" id="Action" name="genres" value="Action" />
          <label for="Action">Action</label>
          <input type="checkbox" id="Adult" name="genres" value="Adult" />
          <label for="Adult">Adult</label>
          <input type="checkbox" id="Adventure" name="genres" value="Adventure" />
          <label for="Adventure">Adventure</label>
          <input type="checkbox" id="Animation" name="genres" value="Animation" />
          <label for="Animation">Animation</label>
          <input type="checkbox" id="Biography" name="genres" value="Biography" />
          <label for="Biography">Biography</label>
          <input type="checkbox" id="Comedy" name="genres" value="Comedy" />
          <label for="Comedy">Comedy</label>
          <input type="checkbox" id="Crime" name="genres" value="Crime" />
          <label for="Crime">Crime</label>
          <input type="checkbox" id="eDocumentary" name="genres" value="Documentary" />
          <label for="Documentary">Documentary</label>
          <input type="checkbox" id="Drama" name="genres" value="Drama" />
          <label for="Drama">Drama</label>
          <input type="checkbox" id="FaithAndSpirituality" name="genres" value="Faith and Spirituality" />
          <label for="FaithAndSpirituality">Faith and Spirituality</label>
          <input type="checkbox" id="Family" name="genres" value="Family" />
          <label for="Family">Family</label>
          <input type="checkbox" id="Fantasy" name="genres" value="Fantasy" />
          <label for="Fantasy">Fantasy</label>
          <input type="checkbox" id="FilmNoir" name="genres" value="Film Noir" />
          <label for="FilmNoir">Film Noir</label>
          <input type="checkbox" id="GameShow" name="genres" value="Game Show" />
          <label for="GameShow">Game Show</label>
          <input type="checkbox" id="History" name="genres" value="History" />
          <label for="History">History</label>
          <input type="checkbox" id="Horror" name="genres" value="Horror" />
          <label for="Horror">Horror</label>
          <input type="checkbox" id="Musical" name="genres" value="Musical" />
          <label for="Musical">Musical</label>
          <input type="checkbox" id="Music" name="genres" value="Music" />
          <label for="Music">Music</label>
          <input type="checkbox" id="Mystery" name="genres" value="Mystery" />
          <label for="Mystery">Mystery</label>
          <input type="checkbox" id="News" name="genres" value="News" />
          <label for="News">News</label>
          <input type="checkbox" id="RealityTV" name="genres" value="Reality-TV" />
          <label for="RealityTV">Reality-TV</label>
          <input type="checkbox" id="Romance" name="genres" value="Romance" />
          <label for="Romance">Romance</label>
          <input type="checkbox" id="SciFi" name="genres" value="Sci-Fi" />
          <label for="SciFi">Sci-Fi</label>
          <input type="checkbox" id="Short" name="genres" value="Short" />
          <label for="Short">Short</label>
          <input type="checkbox" id="Sport" name="genres" value="Sport" />
          <label for="Sport">Sport</label>
          <input type="checkbox" id="TalkShow" name="genres" value="Talk-Show" />
          <label for="TalkShow">Talk-Show</label>
          <input type="checkbox" id="Thriller" name="genres" value="Thriller" />
          <label for="Thriller">Thriller</label>
          <input type="checkbox" id="War" name="genres" value="War" />
          <label for="War">War</label>
          <input type="checkbox" id="Western" name="genres" value="Western" />
          <label for="Western">Western</label>
          <br />
          <label for="runtime">Runtime</label>
          <input class="input-newMovie" type="text" id="runtime" name="runtime" placeholder="2h 13m" /><br /><br />
          <label for="imdbScore">IMDB Score</label>
          <input class="input-newMovie" type="number" id="imdbScore" name="imdbScore" min="1.0" max="10.0" step="0.1" placeholder="7.5" /><br /><br />
          <label for="rottenTomatoes">Rotten Tomatoes Score</label>
          <input class="input-newMovie" type="text" id="rottenTomatoes" name="rottenTomatoes" placeholder="84%" /><br /><br />
          <label for="poster">Poster Image</label>
          <input class="input-newMovie" type="url" id="poster" name="poster" placeholder="url of shareable image" /><br /><br />
          <label for="trailer">Official Trailer</label>
          <input class="input-newMovie" type="url" id="trailer" name="trailer" placeholder="url of official trailer" /><br /><br />
          <label for="isPremier">Movie is a Premier? (check if true)</label>
          <input type="checkbox" id="isPremier" name="isPremier" /><br /><br />
          <label for="startDate">Showtime Start Date</label>
          <input class="input-newMovie" type="date" id="startDate" name="startDate" placeholder="YYYY-MM-DD" /><br /><br />
          <label for="endDate">Showtime End Date</label>
          <input class="input-newMovie" type="date" id="endDate" name="endDate" placeholder="YYYY-MM-DD" /><br /><br />
          <label for="isActive">Display Status Active? (check if active)</label>
          <input type="checkbox" id="isActive" name="isActive" /><br /><br />
          <button type="submit">Update Movie</button>
        </div>
      </form>
      <div id="message"></div>
      <div>
        <a href="https://sanjuantheater.onrender.com/"><p>Return Home</p></a>
      </div>
    </main>
    <footer class="obliqua">
      &copy; <span id="currentYear"></span> | 10 South Main St | Blanding Utah |
      <a class="footerLink" href="https://sanjuantheater.onrender.com">San Juan Movie Theater</a><br />
      Last Updated: <span id="updateDate"></span>
    </footer>
    <script src="/script/footerFunction.js"></script>
    <script>
      async function getMovie(event) {
        event.preventDefault();
        const _id = document.getElementById('_id').value;
        const response = await fetch(`https://sanjuantheater.onrender.com/movies/${_id}`);
        if (!response.ok) {
          alert('Movie not found');
          return;
        }
        const data = await response.json();
        console.log(data);
        const formFieldsDiv = document.getElementById('updateFormFields');
        formFieldsDiv.style.display = 'block';
        const form = document.getElementById('updateMovieForm');

        for (let element of form.elements) {
          if (element.id in data && data[element.id] !== null && data[element.id] !== undefined) {
            if (element.type === 'checkbox') {
              if (element.id === 'isPremier' || element.id === 'isActive') {
                element.checked = data[element.id];
              } else (data.genres && data.genres.includes(element.value)) {
                element.checked = true;
              }
            } else if (element.type === 'radio' && element.value === data.certification) {
              element.checked = true;
            } else {
              element.value = data[element.id];
            }
          }
        }
      }

      document.getElementById('updateMovieForm').addEventListener('submit', async function (event) {
        event.preventDefault();

        const formData = new FormData(this);
        const movieData = {};
        formData.forEach((value, key) => {
          if (value.trim() !== '') {
            if (key === 'genres') {
              if (!movieData[key]) {
                movieData[key] = [];
              }
              movieData[key].push(value);
            } else if (key === 'isPremier' || key === 'isActive') {
              movieData[key] = value === 'false';
            } else {
              movieData[key] = value;
            }
          }
        });
        const _id = movieData['_id'];
        delete movieData['_id'];
        const response = await fetch(`https://sanjuantheater.onrender.com/movies/update/${_id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(movieData)
        });

        const messageDiv = document.getElementById('message');
        if (response.ok) {
          const data = await response.text();
          messageDiv.textContent = data;
        } else {
          const errorMessage = await response.text();
          messageDiv.textContent = errorMessage;
        }
      });
    </script>
  </body>
</html>
