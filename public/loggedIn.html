<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>San Juan Theater | Logged In</title>
    <meta name="description" content="Admin Logged In Page for San Juan Theater" />
    <link rel="stylesheet" href="https://use.typekit.net/vem8cxz.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://kit.fontawesome.com/db6c0dda2a.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <header id="main-header">
      <div class="header">
        <img src="/images/Theater_logo_new_2.svg" class="header-logo" alt="San Juan Theater Logo" />
        <nav class="nav">
          <a href="https://sanjuantheater.onrender.com/" target="_self" class="active" id="userGreeting">Hello, {{userName}}!</a>
          <a href="/movies.html" target="_blank">Add Movies</a>
          <a href="/updateMovies.html" target="_blank">Update Movies</a>
          <a href="/news.html" target="News">Add News</a>
          <a href="/events.html" target="_blank">Add Events</a>
          <a href="/users.html" target="_blank">Manage Users</a>
        </nav>
      </div>
    </header>
    <main>
      <div class="headings">
        <section class="Events">
          <h1 class="eventsHeader">Events</h1>
          <div id="eventsContainer"></div>
        </section>
        <section class="nowPlaying">
          <h2>Now Playing</h2>
          <div class="nowPlayingContainer" id="nowPlayingContainer"></div>
          <div id="message"></div>
        </section>
        <section class="comingSoon">
          <h2 class="urbaneBold">Coming Soon</h2>
          <div id="comingSoonContainer"></div>
          <div id="message"></div>
        </section>
        <a href="designPrinciples/index.html"><h2 class="designLink urbaneBold">Design Principles</h2></a>
        <a href="https://sanjuantheater.onrender.com/api-docs"><h2 class="documentationLink urbaneBold">Documentation</h2></a>
      </div>
      <div class="logout">
        <button><a href="https://sanjuantheater.onrender.com/logout">Sign Out</a></button>
      </div>
    </main>
    <footer class="obliqua">
      &copy; <span id="currentYear"></span> | 10 South Main St | Blanding Utah |
      <a class="footerLink" href="https://sanjuantheater.onrender.com">San Juan Movie Theater</a><br />
      Last Updated: <span id="updateDate"></span>
    </footer>
    <script src="/script/footerFunction.js"></script>
    <script>
      fetch('https://sanjuantheater.onrender.com/movies/nowplaying')
        .then((response) => response.json())
        .then((data) => {
          const cardsContainer = document.getElementById('nowPlayingContainer');

          // Create a card for each item in the JSON data
          data.forEach((item) => {
            const genresFormatted = item.genres.join(', ');
            const startDate = new Date(item.startDate);
            const endDate = new Date(item.endDate);
            const formattedStartDate = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(
              startDate
            )} ${startDate.getDate()}, ${startDate.getFullYear()}`;
            const formattedEndDate = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(
              endDate
            )} ${endDate.getDate()}, ${endDate.getFullYear()}`;
            const card = document.createElement('div');
            card.className = 'nowPlayingCard';
            card.innerHTML = `
              <h2 class="nowPlayingTitle">${item.title} ${item.year}</h2>
              <h3 class="nowPlayingTagline">${item.tagLine}</h3>
              <h3 class="nowPlayingDates">${formattedStartDate} to ${formattedEndDate}</h3>
              <div class="ratings">
                <p class="nowPlayingRating">Rating: ${item.certification}</p>
                <p class="nowPlayingRuntime">Runtime: ${item.runtime}</p>
                ${item.imdbScore ? `<p class="nowPlayingIMDB"><span class="fa-brands fa-imdb"></span> ${item.imdbScore}</p>` : ''}
                ${item.rottenTomatoes ? `<p class="nowPlayingTomatoes"><span class="fa-solid fa-thumbs-up"></span> ${item.rottenTomatoes}</p>` : ''}
              </div>
              <div class="genres">
                <p class="nowPlayingGenres">Genres: ${genresFormatted}</p>
              </div>
              <div class="nowPlayingCardImage">
                ${item.poster ? `<img src="${item.poster}" class="nowPlayingPoster">` : ''}
              </div>
              <div class="overviewContainer">
                <p class="nowPlayingOverview">${item.overview}</p>
              </div>
              <iframe src="${item.trailer}" class="nowPlayingTrailer"></iframe>
              `;
            cardsContainer.appendChild(card);
          });
        })
        .catch((error) => {
          console.error('Error fetching data:', error);
        });
    </script>
    <script>
      fetch('https://sanjuantheater.onrender.com/movies/comingsoon')
        .then((response) => response.json())
        .then((data) => {
          const cardsContainer = document.getElementById('comingSoonContainer');
          console.log(data);
          // Create a card for each item in the JSON data
          data.forEach((item) => {
            const genresFormatted = item.genres.join(', ');
            const startDate = new Date(item.startDate);
            const endDate = new Date(item.endDate);
            const formattedStartDate = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(
              startDate
            )} ${startDate.getDate()}, ${startDate.getFullYear()}`;
            const formattedEndDate = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(
              endDate
            )} ${endDate.getDate()}, ${endDate.getFullYear()}`;
            const card = document.createElement('div');
            card.className = 'comingSoonCard';
            card.innerHTML = `
              <h2 class="comingSoonTitle">${item.title} ${item.year}</h2>
              <h3 class="comingSoonTagline">${item.tagLine}</h3>
              <h3 class="comingSoonDates">${formattedStartDate} to ${formattedEndDate}</h3>
              <div class="ratings">
                <p class="comingSoonRating">Rating: ${item.certification}</p>
                <p class="comingSoonRuntime">Runtime: ${item.runtime}</p>
                ${item.imdbScore ? `<p class="comingSoonIMDB"><span class="fa-brands fa-imdb"></span> ${item.imdbScore}</p>` : ''}
                ${item.rottenTomatoes ? `<p class="comingSoonTomatoes"><span class="fa-solid fa-thumbs-up"></span> ${item.rottenTomatoes}</p>` : ''}
              </div>
              <div class="genres">
                <p class="comingSoonGenres">Genres: ${genresFormatted}</p>
              </div>
              <div class="comingSoonCardImage">
                ${item.poster ? `<img src="${item.poster}" class="comingSoonPoster">` : ''}
              </div>
              <div class="overviewContainer">
                <p class="comingSoonOverview">${item.overview}</p>
              </div>
              <iframe src="${item.trailer}" class="comingSoonTrailer"></iframe>
              `;
            cardsContainer.appendChild(card);
          });
        })
        .catch((error) => {
          console.error('Error fetching data:', error);
        });
    </script>
  </body>
</html>
